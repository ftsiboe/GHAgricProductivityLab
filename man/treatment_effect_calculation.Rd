% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/matching.R
\name{treatment_effect_calculation}
\alias{treatment_effect_calculation}
\title{Compute log-linear treatment effects (ATE/ATET/ATEU) for multiple outcomes}
\usage{
treatment_effect_calculation(
  data,
  i,
  match_specifications,
  matching_output_directory,
  match_formulas
)
}
\arguments{
\item{data}{A \code{data.frame} containing at least:
\itemize{
\item identifiers: \code{UID}
\item treatment flag: \code{Treat} (logical or 0/1)
\item plot size: \code{Area} (positive; used to area-normalize variables)
\item outcomes: \code{HrvstKg}, \code{Area}, \code{SeedKg}, \code{HHLaborAE}, \code{HirdHr}, \code{FertKg}, \code{PestLt}
\item any covariates referenced in \code{match_formulas$general_match} and \code{match_formulas$exact_match}
}}

\item{i}{Integer index selecting the row of \code{match_specifications} and the matching result
file to load (zero-padded via \code{ARRAY} to \code{"NNNN.rds"}).}

\item{match_specifications}{A \code{data.frame} with at least column \code{ARRAY}; the \code{i}-th
row is used to locate the matching output file and is also cbind-ed to the results.}

\item{matching_output_directory}{Directory containing per-specification matching results
named as \code{"0001.rds"}, \code{"0002.rds"}, etc. Each RDS should contain \verb{$md} with \code{UID} and \code{weights}.}

\item{match_formulas}{A list with:
\itemize{
\item \code{general_match}: a \strong{formula} (RHS accessed via \code{as.character(...)[3]})
\item \code{exact_match}: a \strong{formula} (RHS accessed via \code{as.character(...)[2]})
}}
}
\value{
A \code{data.frame} (\code{atet_scalar}) with columns from \code{match_specifications[i, ]}
joined to rows:
\itemize{
\item \code{outcome}, \code{treatment}
\item \code{level} in \{\code{ATE},\code{ATET},\code{ATEU},\code{aic},\code{ll},\code{R2},\code{N},\code{Ft},\code{R2a}\}
\item \code{est} (numeric estimate)
}
}
\description{
For a given matching specification index \code{i}, this function:
\enumerate{
\item loads the corresponding matched sample weights from disk,
\item merges them into the analysis \code{data} via \code{UID},
\item normalizes selected inputs/outputs by plot \code{Area},
\item fits a weighted log-linear model for each outcome with interactions between \code{Treat}
and the provided matching covariate formulas,
\item transforms fitted differences to percentage effects, trims extreme values, and
computes weighted ATE, ATET, and ATEU alongside model fit statistics.
}

\strong{Note:} The function returns a long table of results (\code{atet_scalar}), not the index \code{i}.
}
\details{
For each outcome in \code{c("HrvstKg","Area","SeedKg","HHLaborAE","HirdHr","FertKg","PestLt")}, fits:
\preformatted{
log(outcome + eps) ~ Treat * (general_match_rhs + exact_match_rhs)
}
where \code{eps = min(outcome[outcome>0]) * 1/100}. Treatment effect is
\deqn{TE_OLS = (e^{\hat{y}_1 - \hat{y}_0} - 1) \times 100} trimmed to \eqn{[-100,100]}.
}
