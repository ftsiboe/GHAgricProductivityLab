% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stochastic_frontier-core.R
\name{sf_workhorse}
\alias{sf_workhorse}
\title{Stochastic frontier workhorse (unrestricted and shape-constrained)}
\usage{
sf_workhorse(
  data,
  yvar,
  xlist,
  wvar = NULL,
  d,
  f,
  slope_shifter = "NONE",
  intercept_shifters = NULL,
  ulist = NULL,
  vlist = NULL,
  identifiers,
  include_trend = FALSE
)
}
\arguments{
\item{data}{A data.frame or data.table containing all variables required for
estimation, including the dependent variable \code{yvar}, inputs
\code{xlist}, the weight variable \code{wvar} (if used), the unique ID
variables listed in \code{identifiers}, and any variables referenced in
\code{slope_shifter}, \code{intercept_shifters}, \code{ulist}, or
\code{vlist}.}

\item{yvar}{Character scalar. Name of the dependent/output variable in
\code{data} used for the production frontier.}

\item{xlist}{Character vector of input variable names (e.g., land, labor,
capital). The order of variables in \code{xlist} determines how they map
into the generic input labels \code{I1}, \code{I2}, \ldots used in the
functional-form utilities.}

\item{wvar}{Optional character scalar. Name of the sampling/observation
weight variable. If \code{NULL}, all observations are given unit weight.}

\item{d}{Distributional form index for the inefficiency term. This is passed
to \code{sf_functional_forms()} and ultimately to \code{sfacross()} (e.g., to
select half-normal, truncated-normal, etc.). The exact mapping is
determined by \code{sf_functional_forms()}.}

\item{f}{Functional form index for the production frontier (e.g.,
Cobb-Douglas, translog, quadratic), used to select from the list returned
by \code{sf_functional_forms()}. The name of the chosen form (e.g., \code{"CD"},
\code{"TL"}, \code{"QD"}, \code{"LN"}) influences logging of variables and
regularity checks.}

\item{slope_shifter}{Character scalar giving the name of a slope-shifter
variable in \code{data} (e.g., technology shift, policy dummy). Defaults
to \code{"NONE"} for no slope shifter and is passed to
\code{equation_editor()}.}

\item{intercept_shifters}{Optional named list of intercept shifter variables
for the production function. Typical structure:
\code{list(Svarlist = c(...), Fvarlist = c(...))}, where the specific
interpretation is handled inside \code{equation_editor()}.}

\item{ulist}{Optional named list describing the inefficiency-function
covariates. Typical structure:
\code{list(Svarlist = c(...), Fvarlist = c(...))}, passed as
\code{uhet} and \code{muhet} to \code{sfacross()} when non-\code{NULL}.}

\item{vlist}{Optional named list describing the production-risk (noise)
covariates. When non-\code{NULL}, used as \code{vhet} in
\code{sfacross()} to allow heteroskedasticity of the noise term.}

\item{identifiers}{Character vector of variable names that uniquely identify
observations (e.g., \code{c("unique_identifier","Survey","CropID","HhId","EaId","Mid")}).
These IDs are carried through to efficiency, elasticity, and risk
outputs.}

\item{include_trend}{Logical; if \code{TRUE}, the last element in \code{xlist} is
treated as a trend/technology variable and handled accordingly in the
functional-form and elasticity calculations. Defaults to \code{FALSE}.}
}
\value{
A named list with four data.frames:
\itemize{
\item \code{sf}: Coefficient-level results combining unrestricted and,
when applicable, restricted SFA estimates, plus monotonicity/curvature
diagnostics. Columns include (at minimum) \code{CoefName},
\code{Estimate}, \code{StdError}, \code{Zvalue}, \code{Pvalue}, and
\code{restrict}.
\item \code{ef}: Observation-level efficiency results (unrestricted and
restricted), including the ID variables in \code{identifiers}, weights,
efficiency measures (e.g., \code{u}), model-fitted values
(\code{mlFitted}), and \code{restrict}.
\item \code{el}: Observation-level elasticities and
returns-to-scale-type measures. Includes IDs, weights, elasticity
columns (e.g., \code{el1}, \code{el2}, \dots, and the summed
elasticity), and \code{restrict}.
\item \code{rk}: Observation-level risk measures (unrestricted and
restricted), including IDs, weights, and \code{risk}, plus
\code{restrict}.
}
}
\description{
Fits a stochastic frontier model for a given production specification and,
when monotonicity is sufficiently violated, re-estimates a
shape-constrained (restricted) frontier using minimum-distance methods.
The function wraps the underlying \code{sfaR} estimation routines and a set
helper utilities (e.g., \code{sf_functional_forms()}, \code{equation_editor()},
\code{Fxn.fit_organizer()}, \code{translogEla()}, curvature/monotonicity
checks) to produce:
\enumerate{
\item Unrestricted stochastic frontier estimates and diagnostics.
\item Shape-constrained estimates that enforce monotonicity (and related
regularity conditions) when needed.
\item Observation-level efficiencies, fitted values, and risk measures.
\item Observation-level elasticities, including a "returns-to-scale" term.
}
}
\details{
The function proceeds in several steps:
\enumerate{
\item \strong{Setup and functional form selection:}
Using \code{sf_functional_forms()}, the function determines the appropriate
production functional form and distributional specification based on
the number of inputs (\code{number_of_inputs}), the \code{f} and \code{d} indices,
and the \code{include_trend} flag. This includes whether the model is specified
in logs (e.g., CD/TL/GP/TP) or levels.

\item \strong{Variable construction and equation building:}
Inputs in \code{xlist} are mapped to generic labels (\code{I1}, \code{I2},
\dots) and their log transforms are created when needed. The outcome
variable is set to \code{Y} or \code{lnY}. The function then calls
\code{equation_editor()} to construct the production, inefficiency,
and risk equations used by \code{sfacross()}.

\item \strong{Unrestricted stochastic frontier estimation:}
The function iterates over a grid of optimization methods
(\code{nr}, \code{nm}, \code{bfgs}, \code{bhhh}, \dots) and tolerance
settings, calling \code{sfacross()} until a successful convergence is
reported. It extracts observation-level efficiencies via
\code{sfaR::efficiencies()}, constructs fitted values, and builds an
observation-level risk metric based on squared deviations from mean
output.

\item \strong{Elasticities and regularity checks:}
Using \code{Fxn.fit_organizer()} and \code{translogEla()}, the function
computes elasticities and returns-to-scale-type measures, and evaluates
monotonicity and curvature via \code{translogCheckMono()} and
\code{translogCheckCurvature()} (or a coefficient-sign check for CD/LN
forms).

\item \strong{Shape-constrained frontier (if needed):}
If the monotonicity measure \code{mono} falls below 0.80, the function
constructs a set of linear restrictions using \code{translogMonoRestr()}
and solves a quadratic programming problem (via \code{quadprog::solve.QP}
and fall-back matrix inversions using \pkg{Matrix}, \pkg{MASS},
\pkg{corpcor}) to obtain constrained coefficients. For TL/QD forms a
constrained frontier (\code{lcFitted}) is computed with
\code{translogCalc()}; for CD/LN forms, constrained coefficients are
obtained via a SEM representation using \pkg{lavaan}.

\item \strong{Re-estimation under constraints:}
Given the constrained frontier, the function rebuilds the production
equation with \code{equation_editor()} and re-estimates a
stochastic frontier (\code{sfc}) using the same optimization grid.
Constrained efficiencies, risks, and elasticities are computed and
summarized, and regularity checks are repeated.
}

Unrestricted and restricted summaries are then stacked, with a
\code{restrict} flag (\code{"Unrestricted"} vs. \code{"Restricted"}), for
downstream comparison.
}
\seealso{
Other frontier analysis: 
\code{\link{equation_editor}()},
\code{\link{fit_organizer}()},
\code{\link{msf_workhorse}()},
\code{\link{sf_functional_forms}()},
\code{\link{sf_model_specifications}()},
\code{\link{sfaR_summary}()}
}
\concept{frontier analysis}
