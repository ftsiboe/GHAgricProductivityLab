% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/matching.R
\name{draw_matched_samples}
\alias{draw_matched_samples}
\title{Draw matched samples (stratified bootstrap + matching)}
\usage{
draw_matched_samples(
  i,
  data,
  match_variables_exact,
  match_variables_scaler,
  match_variables_factor,
  match_specifications,
  sample_draw_list,
  verbose = FALSE
)
}
\arguments{
\item{i}{Integer index selecting the row of \code{match_specifications} to use.}

\item{data}{A data.frame/data.table containing at least:
\code{Surveyx, EaId, HhId, Mid, UID, Weight, Treat}, plus columns named in \code{Emch, Scle, Fixd}.}

\item{match_variables_exact}{A character vector of variable names to be included
in the exact match component (e.g., \code{"gender"}, \code{"region"}).}

\item{match_variables_scaler}{A character vector of continuous or scalar variable names
to include as covariates in the general match formula (e.g., \code{"age"}, \code{"income"}).}

\item{match_variables_factor}{A character vector of factor variable names
to be included as dummy-coded categorical covariates in the general match formula.}

\item{match_specifications}{Data frame of matching specifications with columns
\code{boot}, \code{method}, \code{distance}, and optionally \code{link}.}

\item{sample_draw_list}{Data frame where column \code{ID} identifies the bootstrap draw,
and each remaining column corresponds to a \code{Survey} containing the sampled \code{EaId}.}

\item{verbose}{Logical; if \code{TRUE}, prints the chosen matching method and timing. Default \code{FALSE}.}
}
\value{
A list with:
\describe{
\item{\code{match_specifications}}{The selected row from \code{match_specifications}.}
\item{\code{m.out}}{The \code{matchit} object.}
\item{\code{md}}{Matched data: \code{Surveyx, EaId, HhId, Mid, UID, weights, pWeight}.}
\item{\code{df}}{The analysis data with adjusted weights: \code{Surveyx, EaId, HhId, Mid, UID, pWeight}.}
}
}
\description{
Performs stratified resampling at the \code{Surveyx, EaId} level (excluding EaIds
listed for the current bootstrap \code{ID}) and computes adjusted sampling weights
used for matching. Then fits a matching model per \code{match_specifications[i, ]} using
\pkg{MatchIt}, with exact matching on \code{Emch} and distance/link from \code{match_specifications}.
}
\details{
Adjusted weights are computed as \eqn{pWeight = Weight \times (alloc/allocj)},
where \code{alloc} is the pre-exclusion sum of \code{Weight} by \code{Surveyx, EaId}
and \code{allocj} is the post-exclusion sum.

Exact matching is performed on variables in \code{Emch}. The distance model
formula is constructed as \code{Treat ~ Scle + Fixd}. When \code{distance == "glm"},
\code{m.order = "largest"} is used; otherwise \code{"closest"}.
}
