% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/draw_matched_samples.R
\name{draw_matched_samples}
\alias{draw_matched_samples}
\title{Draw matched samples (stratified bootstrap + matching)}
\usage{
draw_matched_samples(
  data,
  Emch,
  Scle,
  Fixd,
  m.specs,
  i,
  drawlist,
  verbose = FALSE
)
}
\arguments{
\item{data}{A data.frame/data.table containing at least:
\code{Surveyx, EaId, HhId, Mid, UID, Weight, Treat}, plus columns named in \code{Emch, Scle, Fixd}.}

\item{Emch}{Character vector of covariate names used for exact matching.}

\item{Scle}{Character vector of covariate names used in the distance model (scaling).}

\item{Fixd}{Character vector of additional fixed covariates in the distance model.}

\item{m.specs}{Data frame of matching specifications with columns
\code{boot}, \code{method}, \code{distance}, and optionally \code{link}.}

\item{i}{Integer index selecting the row of \code{m.specs} to use.}

\item{drawlist}{Data frame where column \code{ID} identifies the bootstrap draw,
and each remaining column corresponds to a \code{Survey} containing the sampled \code{EaId}.}

\item{verbose}{Logical; if \code{TRUE}, prints the chosen matching method and timing. Default \code{FALSE}.}
}
\value{
A list with:
\describe{
\item{\code{m.specs}}{The selected row from \code{m.specs}.}
\item{\code{m.out}}{The \code{matchit} object.}
\item{\code{md}}{Matched data: \code{Surveyx, EaId, HhId, Mid, UID, weights, pWeight}.}
\item{\code{df}}{The analysis data with adjusted weights: \code{Surveyx, EaId, HhId, Mid, UID, pWeight}.}
}
}
\description{
Performs stratified resampling at the \code{Surveyx, EaId} level (excluding EaIds
listed for the current bootstrap \code{ID}) and computes adjusted sampling weights
used for matching. Then fits a matching model per \code{m.specs[i, ]} using
\pkg{MatchIt}, with exact matching on \code{Emch} and distance/link from \code{m.specs}.
}
\details{
Adjusted weights are computed as \eqn{pWeight = Weight \times (alloc/allocj)},
where \code{alloc} is the pre-exclusion sum of \code{Weight} by \code{Surveyx, EaId}
and \code{allocj} is the post-exclusion sum.

Exact matching is performed on variables in \code{Emch}. The distance model
formula is constructed as \code{Treat ~ Scle + Fixd}. When \code{distance == "glm"},
\code{m.order = "largest"} is used; otherwise \code{"closest"}.
}
