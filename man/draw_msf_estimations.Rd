% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/draw_msf.R
\name{draw_msf_estimations}
\alias{draw_msf_estimations}
\title{Run a single MSF draw and summarize stochastic frontier results}
\usage{
draw_msf_estimations(
  draw,
  drawlist,
  surveyy = FALSE,
  data,
  output_variable,
  input_variables,
  inefficiency_covariates = NULL,
  risk_covariates = NULL,
  weight_variable = NULL,
  production_slope_shifters = NULL,
  intercept_shifters = NULL,
  f,
  d,
  identifiers,
  include_trend = FALSE,
  technology_variable = NULL,
  matching_type = NULL,
  adoption_covariates = NULL,
  intercept_shifters_meta = NULL,
  disagscors_list = NULL,
  match_specifications,
  match_specification_optimal,
  match_path
)
}
\arguments{
\item{draw}{Integer (or numeric coercible to integer). Draw iteration index.
Typically \code{0} is used for the full baseline sample and positive
integers for resampled or matched draws.}

\item{drawlist}{A data.frame or similar object containing exclusion
information by draw. Rows correspond to draws, with column \code{ID}
identifying the draw and subsequent columns containing \code{EaId}
values to remove from \code{data} for that draw.}

\item{surveyy}{Logical; if \code{TRUE}, uses the survey labels stored in
\code{data$Surveyx}. If \code{FALSE} (default), all observations are
assigned to a synthetic survey labeled \code{"GLSS0"} for estimation.}

\item{data}{A data.frame or data.table containing the estimation sample.
Must include, at minimum, the columns referenced in other arguments
(e.g., \code{output_variable}, \code{input_variables}, \code{identifiers}, \code{weight_variable}, technology
and matching variables, and any variables used in
\code{disagscors_list}).}

\item{output_variable}{Character scalar. Name of the dependent (output) variable used
in the production frontier.}

\item{input_variables}{Character vector of input (production) variables entering the
stochastic frontier.}

\item{inefficiency_covariates}{Optional named list specifying variables in the inefficiency
function. Typical structure:
\code{list(Svarlist = c(...), Fvarlist = c(...))}.}

\item{risk_covariates}{Optional named list specifying variables in the production
risk (noise) function. If \code{NULL}, a homoskedastic noise term is
usually implied.}

\item{weight_variable}{Optional character scalar giving the name of the sampling
weight variable in \code{data}. Used when computing weighted summaries
(e.g., weighted means) of efficiency scores.}

\item{production_slope_shifters}{Character scalar naming a variable that shifts the
production-function slope (e.g., technology shifter). Defaults to
\code{NULL} to indicate no slope shifter.}

\item{intercept_shifters}{Optional named list of intercept shifter
variables for the baseline (unmatched) sample. Typical structure:
\code{list(Svarlist = c(...), Fvarlist = c(...))}.}

\item{f}{Functional form identifier passed to
\code{msf_workhorse()} (e.g., Cobb-Douglas, translog). The exact
meaning is handled by the workhorse function.}

\item{d}{Distributional form identifier for the inefficiency term
(e.g., half-normal, truncated-normal), passed through to
\code{msf_workhorse()}.}

\item{identifiers}{Character vector of variable names that uniquely identify units
(e.g., household, plot, or observation IDs). These are used to merge
efficiency scores back to \code{data} and for disaggregated summaries.}

\item{include_trend}{Logical; if \code{TRUE}, includes a technology trend variable
(given by \code{technology_variable}) in the frontier. Defaults to \code{FALSE}.}

\item{technology_variable}{Optional character scalar naming the technology (trend)
variable to be used when \code{include_trend = TRUE}.}

\item{matching_type}{Optional variable or object controlling nearest-neighbor
matching; passed to \code{msf_workhorse()}. The expected type and
structure depend on the implementation of that workhorse function.}

\item{adoption_covariates}{Optional named list specifying inefficiency-function
variables for the matched sample (post-matching specification). Same
structure as \code{inefficiency_covariates}.}

\item{intercept_shifters_meta}{Optional named list of intercept shifters for
the matched sample. Same structure as \code{intercept_shifters}.}

\item{disagscors_list}{Optional character vector of variable names for
which disaggregated efficiency score summaries should be computed.
For each variable in this list, the function builds weighted and
unweighted summaries of TE/TE0/TGR/MTE by survey, sample, and
disaggregation level.}

\item{match_specifications}{match specifications}

\item{match_specification_optimal}{match specifications}

\item{match_path}{match path}
}
\value{
A named list with components:
\itemize{
\item \code{sf_estm} - Combined frontier parameter estimates across
surveys (rows tagged with \code{Surveyy} and \code{draw}).
\item \code{el_mean}, \code{ef_mean}, \code{rk_mean} - Mean/summary
statistics for elasticities, efficiency, and risk metrics.
\item \code{ef_dist}, \code{rk_dist} - Distributions of efficiency and
risk quantities.
\item \code{el_samp}, \code{ef_samp}, \code{rk_samp} - Sample-level
results (only retained when \code{draw == 0}).
\item \code{disagscors} - Optional disaggregated efficiency summary
table if \code{disagscors_list} is not \code{NULL}; otherwise
\code{NULL}.
}
If an error occurs anywhere in the pipeline, the function returns
\code{NULL}.
}
\description{
Performs one iteration of multi-stage stochastic frontier (MSF) estimation
for a given \code{draw}. The function (i) filters the analysis sample using
a draw-specific exclusion list, (ii) calls \code{msf_workhorse()} to
estimate production, inefficiency, and risk components by survey, and
(iii) optionally builds disaggregated efficiency score summaries.
}
\details{
The main outputs include model estimates, mean/percentile summaries, and
(optionally) disaggregated efficiency statistics by user-specified grouping
variables. For draws other than zero, sample-level results are dropped to
reduce storage.

\enumerate{
\item \strong{Draw-specific filtering:}
Using \code{drawlist}, the function removes any \code{EaId} values
associated with the current \code{draw} from \code{data}. This allows
for bootstrap, jackknife, or matched-sample resampling.

\item \strong{Survey-specific estimation:}
After setting the \code{Surveyy} label (either from \code{Surveyx} or
collapsed to \code{"GLSS0"}), the function loops over unique survey
labels and calls \code{msf_workhorse()} for each. The workhorse
is expected to return a list with components such as
\code{sf_estm}, \code{el_mean}, \code{ef_mean}, \code{rk_mean},
\code{ef_dist}, \code{rk_dist}, \code{el_samp}, \code{ef_samp},
and \code{rk_samp}.

\item \strong{Disaggregated efficiency summaries:}
If \code{disagscors_list} is provided, the function constructs
weighted and unweighted efficiency statistics (e.g., weighted mean,
mean, median, mode) for TE/TE0/TGR/MTE by survey, sample, restriction
status, technology, and disaggregation level. Results are stored in
\code{res$disagscors}.

\item \strong{Draw-specific pruning:}
When \code{draw != 0}, sample-level objects (\code{el_samp},
\code{ef_samp}, \code{rk_samp}) are removed from the returned list
to reduce memory usage, keeping only aggregate results.
}

Internally, the function uses \pkg{data.table}, \pkg{dplyr},
\pkg{tidyr}, \pkg{doBy}, and \pkg{crayon} for data manipulation and
progress messages. All estimation is delegated to
\code{msf_workhorse()}.
}
